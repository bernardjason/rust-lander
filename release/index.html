<script>
        var Module = {};
        var __cargo_web = {};
        Object.defineProperty(Module, 'canvas', {
            get: function () {
                if (__cargo_web.canvas) {
                    return __cargo_web.canvas;
                }

                var canvas = document.createElement('canvas');
                // Disable right-click on the canvas
                canvas.addEventListener('contextmenu', event => event.preventDefault());
                canvas.setAttribute("id", "canvas");
                canvas.setAttribute("width", "800");
                canvas.setAttribute("height", "600");
                canvas.setAttribute("tabindex", "1");
                canvas.setAttribute("style", "border:0px");
                // var body = document.querySelector('body')
		        var body = document.getElementById("lander_game_window");
                body.insertBefore(canvas, body.firstChild);
                __cargo_web.canvas = canvas;


                return canvas;
            }
        });

    var audioExplosion = document.createElement("audio");
    audioExplosion.src = "/media/filer_public/rust-lander/hit.wav";
    audioExplosion.preload = "auto";

    var audioThrust = document.createElement("audio");
    audioThrust.src = "/media/filer_public/rust-lander/thrust.ogg";
    audioThrust.preload = "auto";
    audioThrust.loop = true;

    var audioScoop = document.createElement("audio");
    audioScoop.src = "/media/filer_public/rust-lander/scoop.wav";
    audioScoop.preload = "auto";

    var javascript_read_stats;

    function play_sound(id) {
      switch(id) {
          case 1:  audioExplosion.play();
                   break;
          case 2:  audioThrust.play();
                   break;
          case 3:  audioScoop.play();
                   break;
          case -2: audioThrust.pause();
                   break;
          default: console.log("BAD SOUND IS "+id);
      }
    }
    function do_score() {
        stats = javascript_read_stats();
        document.getElementById("score").innerHTML =stats;
        setTimeout("do_score()",1000);
    }
    function start_game() {
		var loading = document.getElementById("loading");
		loading.style.visibility = 'hidden';
        setTimeout("do_score()",1000);
        javascript_read_stats  = Module.cwrap('javascript_read_stats', 'string', []);
    }
    function end_game() {
        document.getElementById("score").style.display ="none";
        document.getElementById("canvas").style.display = "none";
        document.getElementById("end").style.display = "block";
        document.getElementById("finalscore").innerHTML =stats;
    }

    </script>


</head>
<body>

<div class="rust-lander" id="lander_game_window">
    <img id="loading" src="/media/filer_public/rust-lander/loading.png" style="width: 800px; height:600px;">
    <div class="theend" id="end" style="display:none">
        <h1>THE END!!!!</h1>
        <h2 id="finalscore"></h2>
    </div>
</div>
<div style="position:absolute;right: 0; top:30%;">
    <div>
        <p id="score"></p>
    </div>
    <div class="lander-fixed">
        <p>Arrow keys to control lander</p>
        <p>Left shift for thrust</p>
        <p>Change north/south/east/west view around craft with N S E W keys</p>
        <p>Rescue aliens landing on planet.</p>
        <p>Refuel on landing pads</p>
        <p>Don't try to fly to high or land on planet surface</p>

    </div>
</div>
<script src='/media/filer_public/rust-lander/rust-lander.js'></script>